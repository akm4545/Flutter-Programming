# **파이어베이스 연동하기 (파이어베이스, 파이어스토어)**  
# **프로젝트 구상하기**  
파이어베이스를 데이터베이스로 사용하도록 nestJS 서버 기반의 일정 관리 앱을 수정하며 프로젝트를 진행한다. Provider로 
API 연동한 기능을 제거하고 파이어베이스를 대신 연동한다.  
  
# **사전 지식**  
# **파이어베이스**  
파이어베이스(Firebase)는 구글이 인수한 모바일 앱 개발에 최적화된 기능을 제공하는 서비스다. 플러터뿐만 아니라 다른 앱 
개발 프레임워크 그리고 웹이나 서버에서도 이용할 수 있다. 이번 장에서는 파이어베이스의 데이터베이스 기능인 파이어스토어
(Firestore)만 사용하지만 파이어베이스에는 이외에도 수많은 기능이 있다.  
  
![img.png](image/img.png)  
![img.png](image/img2.png)  
  
# **파이어스토어**  
이번 장에서 사용할 파이어베이스의 기능인 파이어스토어는 NoSQL 데이터베이스다. 필요한 서버와 인프라 관리를 구글에서 해주기 
때문에 백엔드 프로그래밍에 대해 크게 신경 쓸 필요 없이 서버를 구성할 수 있다. 클라이언트와 서버의 데이터를 실시간으로 연동하고 
오프라인 지원이 자동으로 되어서 네트워크 지연과 인터넷 연결과 관계없이 데이터를 저장할 수 있다. 또한 파이어베이스에서 제공하는 
파이어스토어 SDK를 사용하면 따로 HTTP 요청 코드를 작성할 필요 없이 제공되는 SDK로 직관적인 프로그래밍을 할 수 있다.  
  
파이어스토어는 유연한 가격 모델을 책정한다. 넓은 범위에서 무료 기능을 제공하고 사용량이 늘어나면 사용한 만큼 돈을 내는 
형태인 Pay As You Go 모델이다. 이번 프로젝트는 간단한 기능만 구현하기 떄문에 무료로 제공되는 범위에서 진행할 수 있다. 
프로덕션에서 파이어스토어를 사용한다면 다음 가격 모델을 참조하자.  
  
![img.png](image/img3.png)  
  
파이어스토어는 두 가지 데이터 개념이 있다. 컬렉션(collection)과 문서(document)이다. SQL 기반의 데이터베이스와 비교하면 
컬렉션은 테이블에 해당되고 문서는 열에 해당된다. NoSQL 문서는 SQL 데이터베이스와 비교해 더 유연한 데이터 구조를 사용할 수 있다. 
예를 들어서 SQL의 테이블에는 행과 열의 조합으로 하나의 행과 열 조합에는 하나의 값만 입력할 수 있다. 하지만 NoSQL의 
문서에서는 키와 값의 조합으로 하나의 값이 들어가는 위치에 리스트나 맵등 완전한 JSON 구조를 통쨰로 저장할 수 있다.  
  
예를 들어 아래의 데이터 구조를 테이블로 만들면 다음과 같은 테이블 2개가 필요하다.  
  
![img.png](image/img4.png)  
  
하지만 NoSQL에서는 JSON 형식을 있는 그대로 저장할 수 있다. 그러니 파이어스토어 또한 위 예제 데이터를 있는 그대로 문서에 
저장할 수 있다. 파이어스토어는 일반 데이터베이스와 마찬가지로 문서 삽입, 삭제, 조회, 업데이트 기능을 제공한다.  
  
# **파이어스토어 문서 삽입**  
파이어스토어에 문서를 삽입하는 방법은 대표적으로 두 가지가 있다. 첫 번째로 add() 함수를 이용한 삽입 방법이다. add() 
함수를 이용해서 문서를 삽입하면 파이어스토어에서 자동으로 문서의 ID 값을 생성해준다.  
  
![img.png](image/img5.png)  
  
FirebaseFirestore.instance를 실행하면 현재 플러터 프로젝트와 연동된 파이어스토어 기능을 불러올 수 있다. collection() 
함수는 문서를 저장할 컬렉션을 지정한다. 매개변수에 컬렉션 이름을 입력한다. add() 함수는 삽입할 문서를 입력할 수 있다. 
매개변수에 Map 형태의 데이터를 입력해주면 된다.  
  
![img.png](image/img6.png)  
  
add() 함수와 다르게 set() 함수를 이용하면 직접 문서의 ID 값을 지정할 수 있다.  
  
![img.png](image/img7.png)  
![img.png](image/img8.png)  
  
collection() 함수까지는 add() 함수를 실행할 떄와 같다. 하지만 다음으로 doc() 함수를 실행하면 문서의 ID 값을 매개변수에 
넣어줄 수 있다. 다음으로 set() 함수를 실행하고 첫 번째 매개변수에 저장하고 싶은 데이터를 입력해주면 ID 값에 해당되는 
데이터를 저장할 수 있다.  
  
![img.png](image/img9.png)  
  
# **파이어스토어 문서 삭제**  
파이어스토어에서 특정 문서를 삭제할 때는 delete() 함수를 사용하면 된다.  
  
![img.png](image/img10.png)  
  
doc() 함수를 실행할 때까지는 set() 함수로 문서를 삽입하는 과정과 같다. collection() 함수에 선택할 컬렉션 이름을 입력하고 
doc() 함수에 삭제할 문서의 ID를 입력해준다. 마지막으로 delete() 함수를 실행해주면 선택된 문서가 삭제된다.  
  
# **파이어스토어 문서 조회**  
파이어스토어는 아주 강력한 문서 조회 기능을 제공한다. 데이터가 변경될 때마다 실시간(Stream) 업데이트를 반영받을 수도 
있고 1회성으로 (Future) 데이터를 업데이트받을 수도 있다.  
  
![img.png](image/img11.png)  
  
collection() 함수에 snapshots() 함수를 실행하면 컬렉션의 모든 문서를 Stream<QuerySnapshot> 형태로 받아올 수 있다. 
Stream 형태로 받아오기 떄문에 컬렉션의 데이터가 업데이트되면 즉시 화면에 반영된다.  
  
Stream 형태로 문서를 받아오면 데이터 조회를 과도하게 많이 하게 될 수 있다. 그래서 파이어스토어는 Future 형태로 일회성으로 
데이터를 가져오는 기능도 제공한다.  
  
![img.png](image/img12.png)  
  
get() 함수를 실행하면 Future<QuerySnapshot>이 반환된다. 즉 실행하는 순간 한 번만 데이터를 받아오고 지속적으로 업데이트하지는 
않는다.  
  
특정 문서를 가져오고 싶으면 doc() 함수를 사용하면 된다. 가져오고 싶은 문서의 ID 값을 매개변수에 입력해주면 선택한 문서를 
불러올 수 있다. 이후 snapshots() 함수로 Stream을 받아오거나 get() 함수로 일회성으로 Future를 받아올 수 있다.  
  
![img.png](image/img13.png)  
  
# **파이어베이스 문서 업데이트**  
문서를 업데이트할 때는 update() 함수를 사용하면 된다.  
  
![img.png](image/img14.png)  
  
update() 함수를 실행하면 선택된 문서들을 update() 함수에 입력된 값들로 업데이트할 수 있다. 이 예제에서는 ID가 1인 
문서의 name값이 '골든래빗'으로 변경된다.  
  
# **사전 준비**  
# **pubspec.yaml 파일 설정하기**  
기존에 추가되어 있는 플러그인 아래에 이번 프로젝트에서 사용할 파이어베이스 플러그인들을 추가한다.  
  
pubspec.yaml 참고  
  
# **iOS 네이티브 설정하기**  
Firebase 플러그인들을 사용하려면 iOS 최소 버전(iOS Minimum Deployment Version)을 13 이상으로 설정해야 한다.  
  
1. iOS -> Runner -> Info.plist 파일을 열고 코드창의 맨 위에 Open iOS/macOS module in Xcode 버튼을 눌러서 XCode를 
실행한다.  
  
![img.png](image/img15.png)  
  
2. Runner -> Runner -> General을 클릭한 후 Minimum Deployments iOS 버전을 13으로 입력한다.  
  
![img.png](image2/img.png)  
  
